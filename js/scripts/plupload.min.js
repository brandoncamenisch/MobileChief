function plu_show_thumbs(e){var t=jQuery,n=t("#"+e+"plupload-thumbs");n.html("");var r=t("#"+e).val(),i=r.split(",");for(var s=0;s<i.length;s++)if(i[s]){var o=t('<div class="thumb" id="thumb'+e+s+'"><img src="'+i[s]+'" alt="" /><div class="thumbi"><a id="thumbremovelink'+e+s+'" href="#">Remove</a></div> <div class="clear"></div></div>');n.append(o);o.find("a").click(function(){var n=t(this).attr("id").replace("thumbremovelink"+e,"");n=parseInt(n);var s=[];r=t("#"+e).val();i=r.split(",");for(var o=0;o<i.length;o++)o!=n&&(s[s.length]=i[o]);t("#"+e).val(s.join());plu_show_thumbs(e);return!1})}if(i.length>1){n.sortable({update:function(r,i){var s=[];n.find("img").each(function(){s[s.length]=t(this).attr("src");t("#"+e).val(s.join());plu_show_thumbs(e)})}});n.disableSelection()}}jQuery.fn.exists=function(){return jQuery(this).length>0};jQuery(document).ready(function(e){if(e(".plupload-upload-uic").exists()){var t=!1;e(".plupload-upload-uic").each(function(){var n=e(this),r=n.attr("id"),i=r.replace("plupload-upload-ui","");plu_show_thumbs(i);t=JSON.parse(JSON.stringify(base_plupload_config));t.browse_button=i+t.browse_button;t.container=i+t.container;t.drop_element=i+t.drop_element;t.file_data_name=i+t.file_data_name;t.multipart_params.imgid=i;t.multipart_params._ajax_nonce=n.find(".ajaxnonceplu").attr("id").replace("ajaxnonceplu","");n.hasClass("plupload-upload-uic-multiple")&&(t.multi_selection=!0);if(n.find(".plupload-resize").exists()){var s=parseInt(n.find(".plupload-width").attr("id").replace("plupload-width","")),o=parseInt(n.find(".plupload-height").attr("id").replace("plupload-height",""));t.resize={width:s,height:o,quality:90}}var u=new plupload.Uploader(t);u.bind("Init",function(e){});u.init();u.bind("FilesAdded",function(t,r){e.each(r,function(e,t){n.find(".filelist").append('<div class="file" id="'+t.id+'"><b>'+t.name+"</b> (<span>"+plupload.formatSize(0)+"</span>/"+plupload.formatSize(t.size)+") "+'<div class="fileprogress"></div></div>')});t.refresh();t.start()});u.bind("UploadProgress",function(t,n){e("#"+n.id+" .fileprogress").width(n.percent+"%");e("#"+n.id+" span").html(plupload.formatSize(parseInt(n.size*n.percent/100)))});u.bind("FileUploaded",function(t,r,s){e("#"+r.id).fadeOut();s=s.response;if(n.hasClass("plupload-upload-uic-multiple")){var o=e.trim(e("#"+i).val());o?o=o+","+s:o=s;e("#"+i).val(o)}else e("#"+i).val(s+"");plu_show_thumbs(i)})})}});